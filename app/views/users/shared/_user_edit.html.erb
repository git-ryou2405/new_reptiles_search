<% Rails.application.config.another_logger.debug "[d] view: ユーザー情報の変更 id=#{@user.id}" %>
<div class="row justify-content-center">
  <div class="col-11">
    <% if @signup == "no_shop_name" %>
      <h2>ショップ情報の登録</h2>
      <% @regist_message = "ショップ情報を登録します。\nこの内容でよろしければOKを押してください。" %>
    <% else %>
      <h2>ショップ情報の編集</h2>
      <% @regist_message = "ショップ情報を更新します。\nこの内容でよろしければOKを押してください。" %>
    <% end %>

    <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f| %>
      <%= render "users/shared/error_messages", resource: resource %>

      <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
        <div>Currently waiting confirmation for: <%= resource.unconfirmed_email %></div>
      <% end %>

      <!-- shop_images -->
        <div class="circle-s_image">
          <!-- イメージ１ -->
          <%= f.label :shop_img1, for: "post_img1" do %>
            <% if current_user.shop_img1.present? %>
              <!-- 登録画像 -->
              <%= image_tag current_user.shop_img1.url, id: "prev_img1", class: "select_img" %>
            <% else %>
              <!-- 選択前 -->
              <div class="before_img1 select_before">
                <div>
                  <i class="fas fa-camera" style="color: #000;"></i>
                  <p style="color: #000; text-align: center; font-size: 10px;"><%= "クリックしてファイル" %><br><%= "アップロード" %></p>
                </div>
              </div>
              <!-- 選択後 -->
              <img src="" id="prev_img1" class="hidden" />
            <% end %>
            
            <%= f.file_field :shop_img1, id: 'post_img1', class: "hidden" %>
          <% end %>
          
          <!-- イメージ２ -->
          <%= f.label :shop_img2, for: "post_img2" do %>
            <% if current_user.shop_img2.present? %>
              <!-- 登録画像 -->
              <%= image_tag current_user.shop_img2.url, id: "prev_img2", class: "select_img" %>
            <% else %>
              <!-- 選択前 -->
              <div class="before_img2 select_before">
                <div>
                  <i class="fas fa-camera" style="color: #000;"></i>
                  <p style="color: #000; text-align: center; font-size: 10px;"><%= "クリックしてファイル" %><br><%= "アップロード" %></p>
                </div>
              </div>
              <!-- 選択後 -->
              <img  src="" id="prev_img2" class="hidden" />
            <% end %>
            
            <%= f.file_field :shop_img2, id: 'post_img2', class: "hidden" %>
          <% end %>
          
          <!-- イメージ３ -->
          <%= f.label :shop_img3, for: "post_img3" do %>
            <% if current_user.shop_img3.present? %>
              <!-- 登録画像 -->
              <%= image_tag current_user.shop_img3.url, id: "prev_img3", class: "select_img" %>
            <% else %>
              <!-- 選択前 -->
              <div class="before_img3 select_before">
                <div>
                  <i class="fas fa-camera" style="color: #000;"></i>
                  <p style="color: #000; text-align: center; font-size: 10px;"><%= "クリックしてファイル" %><br><%= "アップロード" %></p>
                </div>
              </div>
              <!-- 選択後 -->
              <img  src="" id="prev_img3" class="hidden" />
            <% end %>
            
            <%= f.file_field :shop_img3, id: 'post_img3', class: "hidden" %>
          <% end %>

        </div>
      <!-- shop_images /-->
      
<script>
$( document ).on('turbolinks:load', function() {
  let prev_img = "";
  
  function readURL(input) {
    if (input.files && input.files[0]) {
      var reader = new FileReader();
      
      // 元々隠していたimgタグのURI（表示先uri）を取得し、file_fieldから取り込んだfileを、readAsDataURLによって、取得したURIで読み込むようにする。
      reader.onload = function (e) {
        $(prev_img).attr('src', e.target.result);      // 's_image_img_prev'属性の'src'と、ロードされた画像ファイルのData URIスキームを取得
      }
      reader.readAsDataURL(input.files[0]);                       // readAsDataURL・・・ファイルを、Data URIとして読み込むメソッド
    }
  }
  
  $("#post_img1").change(function(){
    $('#prev_img1').removeClass('hidden').addClass('select_img'); // 指定した要素に・・
    $('.before_img1').remove();                                   // 要素を削除
    prev_img = '#prev_img1';
    readURL(this);
  });
  $("#post_img2").change(function(){
    $('#prev_img2').removeClass('hidden').addClass('select_img'); // 指定した要素に・・
    $('.before_img2').remove();                                   // 要素を削除
    prev_img = '#prev_img2';
    readURL(this);
  });
  $("#post_img3").change(function(){
    $('#prev_img3').removeClass('hidden').addClass('select_img'); // 指定した要素に・・
    $('.before_img3').remove();                                   // 要素を削除
    prev_img = '#prev_img3';
    readURL(this);
  });
});
</script>
      
      <!--
      <div class="field">
        <%= f.label :email, class: "mt-2" %>
        <%= f.email_field :email, autofocus: false, autocomplete: "email", class: "form-control" %>
      </div>
      -->
      
      <div class="field">
        <%= f.label :shop_name, class: "mt-2" %><span>必須</span>
        <%= f.text_field :shop_name, autofocus: false, autocomplete: "shop_name", class: "form-control mg-tb-6" %>
      </div>
      
      <!-- 都道府県の選択 -->
      <% @prefectures = Prefecture.all %>
      <div class="field">
        <%= f.label :prefectures, class: "mt-2" %><span>必須</span>
        <%= f.collection_select :prefectures, @prefectures, :pref, :pref, {include_blank: true, autocomplete: "prefectures"}, { class: "form-control mg-tb-6" } %>
      </div>
      
      <div class="field">
        <%= f.label :address, class: "mt-2" %><span>必須</span>
        <%= f.text_area :address, autofocus: false, autocomplete: "address", class: "form-control mg-tb-6" %>
      </div>
      
      <div style="margin: 15px 0 15px 0; padding: 10px; background: #555; border-radius: 5px;">
        <div style="float: left; margin-right: 25px;">
          <img src="https://img.icons8.com/color/48/000000/google-maps.png" width="30px" height="30px" /><%= f.label :search_map, class: "mt-1" %>
        </div>
        <div class="mt-2" style="font-size: 12px; text-decoration:underline; text-decoration-color: green;">登録内容からGoogleマップを表示できます。</div>
        
        <div style="padding: 10px 0 0 14px; clear: both;">
          <label style="font-size: 14px">
            <%= f.radio_button :search_map, "1" %>"ショップ名" でマップ検索
          </label><br>
          <%#= f.label :search_map_shop, "ショップ名" %>
          
          <div style="float: right; font-size: 10px;">
            ※Googleマップで店舗情報を登録済の場合　<br>
            　"ショップ名"の検索がオススメです。
            <%# マップ検索する情報をどちらかご選択ください。<br> %>
          </div>
          
          <label style="font-size: 14px">
            <%= f.radio_button :search_map, "2" %>"住所" でマップ検索
          </label><br>
          <label style="font-size: 14px">
            <%= f.radio_button :search_map, "3" %>マップを使用しない
          </label>
          <%#= f.label :search_map_address, "住所" %>
        </div>
      </div>
      
      <!-- アクセス方法、電話、営業時間、定休日 -->
      <% arrey = [
        [:howto_access, "howto_access"],
        [:tel, "tel"],
        [:business_hours, "business_hours"],
        [:holiday, "holiday"]
        ] %>
      
      <% arrey.map do |first,second| %>  
        <div class="field">
          <%= f.label first, class: "mt-2" %>
          <%= f.text_field first, autofocus: false, autocomplete: second, class: "form-control mg-tb-6" %>
        </div>
      <% end %>
      
      <!-- 取り扱い、店舗の特徴 -->
      <% text_area = [
        [:handling_animals, "handling_animals","2x2"],
        [:handling_feeds, "handling_feeds","2x2"],
        [:handling_goods, "handling_goods","2x2"],
        ] %>

      <% text_area.map do |first,second,third| %>  
        <div class="field">
          <%= f.label first, class: "mt-2" %>
          <%= f.text_area first, autofocus: false, autocomplete: second, size: third, class: "form-control mg-tb-6" %>
        </div>
      <% end %>
      
      <div class="field">
        <%= f.label :feature, class: "mt-2" %><span>必須</span>
        <%= f.text_area :feature, autofocus: false, autocomplete: "feature", size: "5x5", class: "form-control mg-tb-6" %>
      </div>
      
      <!-- URL、SNS -->
      <% url = [:url,:twitter] %>
        
      <% url.map do |official| %>  
        <div class="field">
          <%= f.label official, class: "mt-2" %>
          <%= f.text_field official, autofocus: false, class: "form-control mg-tb-6" %>
        </div>
      <% end %>
    
      <div class="field">
        <%= f.label :instagram, class: "mt-2" %>（埋め込みコードを入力してください。）
        <%= f.text_field :instagram, autofocus: false, class: "form-control mg-tb-6" %>
      </div>
      
      <div class="actions">
        <%= f.submit "更新", class: "btn btn-primary w-100 mt-4",data: { confirm: @regist_message } %>
      </div>
    <% end %>
  </div>
</div>

<% unless @signup == "no_shop_name" %>
  <br><br>
  <%= link_to "◀︎ マイページへ戻る", @user, style:"font-size: 13px; color: silver;", onMouseOver:"this.style.textDecoration='none'; this.style.color='#ffffff';" %>
<% end %>

<div style="margin-top: 50px; float: right; font-size: 10px; color: black;">
  <a href="https://icons8.com/icon/32215/google-maps-old" target="_blank" >Google Maps Old icon by Icons8</a>
</div>
